<section class="result-section">
    <h2>Student Results</h2>

    <!-- Semester Selection -->
    <div class="semester-selection">
        <form id="semesterForm" method="GET">
            {% for sem in semesters %}
            <label>
                <input type="radio" name="semester" value="{{ sem }}"
                       {% if request.GET.semester == sem|stringformat:"s" %}checked{% endif %}
                       onchange="this.form.submit()">
                <span>Semester {{ sem }}</span>
            </label>
            {% endfor %}
        </form>
    </div>

    <!-- Results Table -->
    <div class="table-container">
        <table id="resultTable" class="result-table">
            <thead>
                <tr>
                    <th>Subject</th>
                    <th>Marks</th>
                    <th>Grade</th>
                    <th>Credits</th>
                </tr>
            </thead>
            <tbody>
                {% if results %}
                    {% for result in results %}
                    <tr>
                        <td>{{ result.subject_id.subject_name }}</td>
                        <td>{{ result.marks_obtained }}</td>
                        <td>{{ result.grade_obtained.grade_name }}</td>
                        <td>{{ result.subject_id.credits }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="4" style="text-align:center;">No results available for this semester.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- SGPA & CGPA -->
    <div class="gpa-box">
        <p><strong>SGPA:</strong> <span id="sgpa">{{ sgpa }}</span></p>
        <p><strong>CGPA:</strong> <span id="cgpa">{{ cgpa }}</span></p>
    </div>

    <!-- Download PDF Button -->
    <div class="download-btn">
        <button id="downloadPDF">Download PDF</button>
    </div>
</section>


<!-- jsPDF + autoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const { jsPDF } = window.jspdf;

    document.getElementById("downloadPDF").addEventListener("click", function () {
        const doc = new jsPDF();

        // Title
        doc.setFontSize(16);
        doc.text("Student Result", 14, 15);

        // Table
        doc.autoTable({
            html: "#resultTable",
            startY: 25,
            styles: { halign: "center" },
            headStyles: { fillColor: [52, 152, 219] }
        });

        // SGPA & CGPA
        const sgpa = document.getElementById("sgpa").textContent;
        const cgpa = document.getElementById("cgpa").textContent;

        doc.setFontSize(12);
        doc.text(`SGPA: ${sgpa}`, 14, doc.lastAutoTable.finalY + 10);
        doc.text(`CGPA: ${cgpa}`, 14, doc.lastAutoTable.finalY + 20);

        // Save PDF
        doc.save("student_result.pdf");
    });
});
</script>
